<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Calculation App</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: manipulation;
        }
        * {
            -webkit-tap-highlight-color: transparent;
        }
        @media screen and (orientation: portrait) {
            #portrait-warning {
                display: flex !important;
            }
            #app {
                display: none !important;
            }
        }
        #portrait-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: system-ui, -apple-system, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .no-scroll {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        .scrollable-text {
            white-space: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .scrollable-text::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        .long-press-overlay {
            animation: pulse 0.3s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="portrait-warning">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-bottom: 20px;">
            <rect x="2" y="5" width="20" height="14" rx="2"/>
            <path d="M9 3v2M15 3v2M9 19v2M15 19v2"/>
        </svg>
        <h1 style="font-size: 24px; margin: 0 0 10px 0;">Please Rotate Your Device</h1>
        <p style="font-size: 16px; opacity: 0.9;">This app works best in landscape mode</p>
    </div>
    
    <div id="app"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const RotateCcw = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
            </svg>
        );
        
        const History = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M12 7v5l4 2"/>
            </svg>
        );
        
        const Undo = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9 14 4 9l5-5"/>
                <path d="M20 20v-7a4 4 0 0 0-4-4H4"/>
            </svg>
        );

        const Maximize = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
            </svg>
        );

        const X = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        function CalculationApp() {
          const [total, setTotal] = useState(0);
          const [currentHistory, setCurrentHistory] = useState([]);
          const [numberUsage, setNumberUsage] = useState({});
          const [savedHistory, setSavedHistory] = useState([]);
          const [showHistory, setShowHistory] = useState(false);
          const [longPressActive, setLongPressActive] = useState(false);
          const [selectedHistoryIndex, setSelectedHistoryIndex] = useState(null);
          
          const touchTimerRef = useRef(null);
          const touchTargetRef = useRef(null);

          useEffect(() => {
            document.body.classList.add('no-scroll');
            return () => document.body.classList.remove('no-scroll');
          }, []);

          const enterFullscreen = () => {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
              elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
              elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
              elem.msRequestFullscreen();
            }
          };

          const getButtonColor = (num) => {
            const usage = numberUsage[num] || 0;
            if (usage === 0) return 'from-gray-400 to-gray-500';
            if (usage <= 2) return 'from-blue-400 to-blue-500';
            if (usage <= 5) return 'from-green-400 to-green-500';
            if (usage <= 10) return 'from-yellow-400 to-yellow-500';
            if (usage <= 20) return 'from-orange-400 to-orange-500';
            return 'from-red-400 to-red-500';
          };

          const numbers = Array.from({ length: 50 }, (_, i) => i + 1);

          const addNumber = (num) => {
            setTotal(prev => prev + num);
            setCurrentHistory(prev => [...prev, num]);
            setNumberUsage(prev => ({
              ...prev,
              [num]: (prev[num] || 0) + 1
            }));
          };

          const undo = () => {
            if (currentHistory.length === 0) return;
            const lastNum = currentHistory[currentHistory.length - 1];
            setTotal(prev => prev - lastNum);
            setCurrentHistory(prev => prev.slice(0, -1));
          };

          const reset = () => {
            if (currentHistory.length > 0) {
              const historyEntry = {
                date: new Date().toLocaleString('en-IN', { 
                  day: '2-digit',
                  month: '2-digit',
                  year: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                }),
                calculation: currentHistory.join('+'),
                total: total
              };
              setSavedHistory(prev => [historyEntry, ...prev]);
            }
            setTotal(0);
            setCurrentHistory([]);
            setNumberUsage({});
          };

          const handleLongPressStart = (e, index) => {
            e.preventDefault();
            touchTargetRef.current = index;
            touchTimerRef.current = setTimeout(() => {
              setLongPressActive(true);
              setSelectedHistoryIndex(index);
              
              // Load the history entry into current calculation
              const entry = savedHistory[index];
              if (entry) {
                // Parse the calculation string back to numbers
                const numbers = entry.calculation.split('+').map(num => parseInt(num.trim()));
                setCurrentHistory(numbers);
                setTotal(entry.total);
                
                // Update number usage based on the loaded numbers
                const newNumberUsage = {};
                numbers.forEach(num => {
                  newNumberUsage[num] = (newNumberUsage[num] || 0) + 1;
                });
                setNumberUsage(newNumberUsage);
                
                // Close history view
                setTimeout(() => {
                  setShowHistory(false);
                  setLongPressActive(false);
                  setSelectedHistoryIndex(null);
                }, 300);
              }
            }, 500); // 500ms for long press
          };

          const handleLongPressEnd = (e) => {
            e.preventDefault();
            if (touchTimerRef.current) {
              clearTimeout(touchTimerRef.current);
              touchTimerRef.current = null;
            }
            setTimeout(() => {
              setLongPressActive(false);
              setSelectedHistoryIndex(null);
            }, 100);
          };

          // Prevent context menu on long press
          useEffect(() => {
            const preventContextMenu = (e) => {
              if (touchTargetRef.current !== null) {
                e.preventDefault();
              }
            };
            
            document.addEventListener('contextmenu', preventContextMenu);
            return () => {
              document.removeEventListener('contextmenu', preventContextMenu);
            };
          }, []);

          return (
            <div className="h-screen w-screen bg-gradient-to-br from-purple-50 to-pink-50 flex items-center justify-center overflow-hidden">
              <div className="w-full h-full p-2 flex flex-col">
                {/* Compact Header - Total and History side by side */}
                <div className="bg-white rounded-xl shadow-lg p-2 mb-2 flex gap-2">
                  <div className="flex-shrink-0 text-center px-3 py-1 bg-purple-50 rounded-lg">
                    <div className="text-gray-600 text-xs font-medium">Total</div>
                    <div className="text-3xl font-bold text-purple-600">{total}</div>
                  </div>
                  <div className="flex-1 bg-gray-50 rounded-lg p-2 overflow-hidden">
                    <div className="text-gray-700 text-sm scrollable-text">
                      {currentHistory.length > 0 ? currentHistory.join(' + ') : 'Start calculating...'}
                    </div>
                  </div>
                </div>

                {/* Compact Action Buttons */}
                <div className="flex gap-2 mb-2">
                  <button
                    onClick={undo}
                    disabled={currentHistory.length === 0}
                    className="flex-1 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white rounded-lg py-2 px-2 text-sm font-semibold flex items-center justify-center gap-1 shadow-md transition-all"
                  >
                    <Undo />
                    Undo
                  </button>
                  <button
                    onClick={reset}
                    className="flex-1 bg-red-500 hover:bg-red-600 text-white rounded-lg py-2 px-2 text-sm font-semibold flex items-center justify-center gap-1 shadow-md transition-all"
                  >
                    <RotateCcw />
                    Reset
                  </button>
                  <button
                    onClick={() => setShowHistory(!showHistory)}
                    className="flex-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg py-2 px-2 text-sm font-semibold flex items-center justify-center gap-1 shadow-md transition-all"
                  >
                    <History />
                    History
                  </button>
                  <button
                    onClick={enterFullscreen}
                    className="flex-1 bg-green-500 hover:bg-green-600 text-white rounded-lg py-2 px-2 text-sm font-semibold flex items-center justify-center gap-1 shadow-md transition-all"
                  >
                    <Maximize />
                    Full
                  </button>
                </div>

                {/* Numbers Grid or History View - NO SCROLL */}
                {showHistory ? (
                  <div className="flex-1 bg-white rounded-xl shadow-lg p-3 overflow-hidden flex flex-col">
                    <div className="flex justify-between items-center mb-2">
                      <h3 className="text-lg font-bold text-gray-800">Previous Calculations</h3>
                      <button onClick={() => setShowHistory(false)} className="text-gray-500 hover:text-gray-700">
                        <X />
                      </button>
                    </div>
                    <div className="flex-1 overflow-y-auto">
                      {savedHistory.length === 0 ? (
                        <div className="text-gray-400 text-center py-8">No history yet</div>
                      ) : (
                        <div className="space-y-2">
                          {savedHistory.map((entry, idx) => (
                            <div 
                              key={idx} 
                              className={`bg-gray-50 rounded-lg p-2 border-l-4 border-purple-500 transition-all ${selectedHistoryIndex === idx ? 'long-press-overlay bg-purple-50' : ''}`}
                              onTouchStart={(e) => handleLongPressStart(e, idx)}
                              onTouchEnd={handleLongPressEnd}
                              onTouchCancel={handleLongPressEnd}
                              onMouseDown={(e) => handleLongPressStart(e, idx)}
                              onMouseUp={handleLongPressEnd}
                              onMouseLeave={handleLongPressEnd}
                            >
                              <div className="text-xs text-gray-500 mb-1">{entry.date}</div>
                              <div className="text-xs text-gray-700 mb-1 scrollable-text">{entry.calculation}</div>
                              <div className="text-base font-bold text-purple-600">Total: {entry.total}</div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                ) : (
                  <div className="flex-1 bg-white rounded-xl shadow-lg p-2 overflow-hidden">
                    <div className="h-full grid grid-rows-5 grid-flow-col gap-1.5">
                      {numbers.map(num => (
                        <button
                          key={num}
                          onClick={() => addNumber(num)}
                          className={`bg-gradient-to-br ${getButtonColor(num)} hover:brightness-110 text-white rounded-lg font-bold text-base shadow-md transition-all active:scale-95 flex items-center justify-center`}
                        >
                          {num}
                        </button>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        ReactDOM.render(<CalculationApp />, document.getElementById('app'));
    </script>
</body>
</html>
